# Exchange Online Contact Synchronization Tool
Integrating CSV Data with Microsoft Graph API

This script is designed to synchronize contact data from a CSV file to Exchange Online using the Microsoft Graph API. 

### Requirements

1. Python 3
2. Required Python libraries:
   - `requests`
   - `azure.identity`
   - `json`
   - `hashlib`
   - `csv`
   - `logging`

You can install the required libraries using `pip`:

```
pip install requests azure-identity
```

### Necessary Files

1. **CSV Files for Input**: 
   - `ansprechpartner_exchange_online.csv`
   - `adressen_exchange_online.csv`
   
   Ensure that these CSV files are in UTF-16 LE BOM format and use a comma `,` as the delimiter.

2. **Script File**: 
   - `sync.py`: This is the main script that performs the synchronization.

### Files That Will Be Created

1. **Control File**:
   - `contacts_control.json`: This file will be generated by the script to keep a record of the contacts that have been synchronized. It uses a hash mechanism to detect changes and decide on synchronization actions. [See more detail](#json-control-file)

2. **Log File**:
   - `sync.log`: This file will log all the actions, information, and errors that occur during the execution of the script.

### Configuration settings within the script:

You'll need to set the following configuration within the `sync.py` script:

1. **Azure App Registration details**:
   - `CLIENT_ID`: The client ID of your Azure App Registration.
   - `CLIENT_SECRET`: The client secret generated in the Azure portal for your App Registration.
   - `TENANT_ID`: The ID of your Azure AD tenant.

2. **Exchange Online Details**:
   - `SHARED_MAILBOX_EMAIL`: The email address of the shared mailbox where the contacts will be synchronized.
   - `FOLDER_CONTACTS`: The name of the contact folder in Exchange Online where the contacts will be stored.

3. **File Paths**:
   - `CSV_PATH_ANSPRECHPARTNER`: Path to the CSV file containing contact details.
   - `CSV_PATH_ADRESSEN`: Path to another CSV file.
   - `CONTROL_FILE`: Path to the JSON control file that will be created/updated during the synchronization.
   - `LOG_FILENAME`: Path to the log file.

### Utilization

1. Ensure all the necessary files are in place and the script has been configured as per the above instructions.
2. Execute the script:

```
python sync.py
```

3. Monitor the `sync.log` file for any information, warnings, or errors.


## JSON Control File

The control file is used to keep track of contacts that have been previously processed and added to the Exchange Online. Each entry in the control file represents a contact and contains two important pieces of information:

 - **ID**: This represents the unique identifier of the contact in Exchange Online.
 - **HASH**: This is an MD5 hash generated from the contact's data. It is used to detect changes in the contact's information.

### How the Control File is Used

#### Loading Existing Contacts

At the beginning of the synchronization process, the control file is read to load all previously processed contacts. This helps the script know which contacts have already been added to Exchange Online and if they have changed since the last sync.

#### Detecting Changes

When processing a contact from the CSV file, the script generates a hash for the contact's data and checks it against the hashes in the control file. If the hash matches an entry in the control file, it means the contact already exists in Exchange Online. The script then decides if the contact needs to be updated (in case the current hash doesn't match the hash in the control file) or if it can be skipped (in case both hashes match).

#### Updating the Control File

 - **For New Contacts**: If a contact from the CSV doesn't have a matching hash in the control file, it's considered a new contact. Once this new contact is successfully added to Exchange Online, a new entry with its ID and hash is appended to the control file.
 - **For Updated Contacts**: If a contact has changed (detected via the hash mismatch), once the contact is successfully updated in Exchange Online, its hash in the control file is updated to the new hash.

#### Cleaning Up

At the end of the script, there's a process to check and remove contacts from Exchange Online that are no longer present in the CSV. If a contact is removed from Exchange Online, its corresponding entry in the control file is also removed.